const { execSync } = require('child_process');

const queryCMD = `curl -d "query=get_file_type&file_type=exe&limit=500" -X POST https://mb-api.abuse.ch/api/v1`


let queryResp 

queryResp = execSync(queryCMD, (err, stdout, stderr) => {
  if (err) {
    //some err occurred
    console.error(err)
  } else {
   // the *entire* stdout and stderr (buffered)
   console.log(`stdout: ${stdout}`);
   console.log(`stderr: ${stderr}`);
  }
});
console.log(JSON.parse(queryResp.toString()))


let exeData = JSON.parse(queryResp.toString())

exeData.data.forEach((exe) => {
    let downloadQuery = `curl -d "query=get_file&sha256_hash=${exe.sha256_hash}" -X POST https://mb-api.abuse.ch/api/v1/ --output ./scraped/${exe.file_name}`
    console.log(exe.tags)
    if(exe.tags.includes("32")){
        execSync(downloadQuery, (err, stdout, stderr) => {
            if (err) {
              //some err occurred
              console.error(err)
            } else {
             // the *entire* stdout and stderr (buffered)
             console.log(`stdout: ${stdout}`);
             console.log(`stderr: ${stderr}`);
            }
          });
    }
    else{
        console.log('Not a 32 bit file')
    }
})

